Copied and modified from cranelift-entity
